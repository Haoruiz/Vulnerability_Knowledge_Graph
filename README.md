# 安全漏洞知识图谱



## 语料的获取
### html文件的提取
"python3.7 execute.py --html_parser 'yes' "
### json文件的提取


## 关系抽取
### 开放域关系对抽取  
使用基于ltp工具包的事件三元组程序  
#### 使用前请先安装ltp工具包  

https://github.com/HIT-SCIR/pyltp
终端运行 openExtraction/pyltp/setup.py  
'python3 openExtraction/pyltp/setup.py'
并下载模型  http://ltp.ai/download.html 下载ltp_data_v3.4.0.zip 解压放入pyltp文件夹

#### 开放域关系抽取
使用Ltp模型，分词，词性识别，实体识别(人名地名机构)，依存句法分析等已训练模型  
识别方式 根据谓词或根据命名实体  
直接将三元组从句子中提出

使用方法："python3.7 execute.py --open_extraction 'yes' --open_input_file 'corpus/漏洞.txt' --open_output_file 'output/漏洞open.csv' "
效果：很多句子无法提取(结果为空)，提取三元组结果不理想

### 实体识别

### 限定域关系抽取

### 实体融合

## 将数据导入neo4j图数据库

首先下载neo4j社区版或购买企业版并安装  
#### 方式1：python程序(使用py2neo) 
"python3 execute.py --importneo4j 'yes' "

#### 方式2：在neo4j图形界面使用cypher语句导入

在Mac或者Linux中，安装好jdk后，直接解压下载好的Neo4J包，运行bin/neo4j start即可
打开浏览器，输入http://localhost:7474/

首先将需要导入的csv文件放入neo4j程序路径的import文件夹

Cypher语句例

'''
全部删除 
MATCH (n) DETACH DELETE n  
 
导入作者 标题 结点和属性  
LOAD CSV WITH HEADERS  FROM "file:///Bug.csv" AS line  
CREATE (a:title{title:line.title,abstract:line.Abstract})  

LOAD CSV WITH HEADERS  FROM "file:///作者1.csv" AS line  
CREATE (c:author{author:line.Author,institute:line.Institute})

LOAD CSV WITH HEADERS  FROM "file:///关键词.csv" AS line  
CREATE (b:keywords{keywords:line.keywords})

导入开放域抽取的关系对
LOAD CSV  WITH HEADERS FROM "file:///漏洞open.csv" AS line
CREATE (entity1:e1{e1:line.entity1}),(entity2:e2{e2:line.entity2})
(relation:r{r:line.relation})

添加索引  
CREATE CONSTRAINT ON (a:title)  
ASSERT a.title IS UNIQUE

导入关系  
LOAD CSV  WITH HEADERS FROM "file:///作者1.csv" AS line  
MATCH (from:title{title:line.title}),(to:author{author:line.Author})  
merge (from)-[r:author_of {}]->(to)  
return r

LOAD CSV  WITH HEADERS FROM "file:///关键词.csv" AS line  
MATCH (from:keywords{keywords:line.keywords}),(to:title{title:line.title})  
merge (from)-[r:keywords_of {}]->(to)  
return r  

CREATE CONSTRAINT ON (entity1:Item)
ASSERT entity1.Item IS UNIQUE
CREATE CONSTRAINT ON (entity2:Item)
ASSERT entity2.Item IS UNIQUE

LOAD CSV  WITH HEADERS FROM "file:///漏洞open.csv" AS line
MATCH (from:e1{e1:line.entity1}),(to:e2{e2:line.entity2})
merge (from)-[r:line.relation{r:relation}]->(to)
return r

除重/其实是合并结点  
MATCH (a:关键词)-[r:keywords_of]-(b:文献)  
WITH a, b, collect(r) as rels  
CALL apoc.refactor.mergeRelationships(rels,{properties:"combine"})  
YIELD rel   
RETURN count(rel)  
apoc是neo4j3.3版本推出时推荐的一个java存储过程包，里面包含丰富的函数和过程，作为对Cypher所不能提供的复杂图算法和数据操作功能的补充，APOC还具有使用灵活、高性能等优势。  
下载及安装方式  
[neo4j数据库中合并相同节点_lili安的博客-CSDN博客_there is no procedure with the name `apoc.refactor](https://blog.csdn.net/likeyou1314918273/article/details/105946179?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-4.nonecase&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-4.nonecase)  

不同节点合并  
MATCH (a:e1),(b:e2),(c:`关键词`),(d.`文献`)  
where a.e1 = b.e2 = c.keywords = d.title  
call apoc.refactor.mergeNodes([a,b,c,d]) YIELD node  
RETURN node  

'''

'''
cypher基本查询语句  
与某结点有关的结点及关系 (:star{name=“王菲”})-->()  
函数  shortestpath() 最短路径  
'''


## Web程序

